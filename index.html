<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カスタムリワードガチャ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* --- Base Layout --------------------------------------------------- */
    html,body{height:100%;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP",sans-serif;background:#f0f0f0;}
    body{display:flex;justify-content:center;align-items:stretch;}
    .container{display:flex;flex-direction:column;max-width:600px;width:100%;padding:20px;box-sizing:border-box;}
    h1{margin:0 0 12px;text-align:center;font-size:1.6em;}

    /* --- Lucky Banner -------------------------------------------------- */
    #luckyBanner{background:#ff9800;color:#fff;padding:4px 8px;border-radius:6px;font-weight:bold;margin-bottom:8px;display:flex;gap:6px;align-items:center;}
    #luckyBanner .timer{font-variant-numeric:tabular-nums;}

    /* --- Game Area ----------------------------------------------------- */
    #gameArea{flex:1 0 auto;display:flex;flex-direction:column;align-items:center;}
    #roulette{margin:12px auto;border-radius:50%;border:8px solid #ccc;width:150px;height:150px;display:flex;align-items:center;justify-content:center;font-size:2em;background:#fff;transition:transform 1s cubic-bezier(.33,1,.68,1);}    
    button{padding:10px;margin:4px 0;width:100%;border-radius:6px;border:1px solid #bbb;background:#fff;cursor:pointer;font-size:1em;}
    button:hover{background:#f7f7f7;}
    .action-buttons{width:100%;max-width:400px;display:flex;gap:4px;flex-wrap:wrap;justify-content:center;}
    .action-buttons button{flex:1 1 120px;}
    #result{font-size:1.3em;text-align:center;margin-top:12px;white-space:pre-line;min-height:2.6em;}
    .hit{animation:bounce .6s ease;}
    @keyframes bounce{0%{transform:scale(0);}60%{transform:scale(1.25);}100%{transform:scale(1);}}

    /* --- History & Input ---------------------------------------------- */
    #rewardHistory{background:#fff;border-radius:8px;padding:10px;margin:18px 0;min-height:44px;}
    .history-title{font-weight:bold;}
    .history-list{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
    .history-item{background:#ffeef0;border:1px solid #e91e63;border-radius:5px;padding:3px 8px;display:flex;align-items:center;}
    .history-remove{margin-left:4px;color:#e91e63;cursor:pointer;font-size:.9em;background:none;border:none;}
    #clearHistoryBtn{margin-left:8px;background:#e91e63;color:#fff;border:none;border-radius:4px;padding:4px 12px;}

    /* --- Rewards Input (bottom) --------------------------------------- */
    #rewardsSection{margin-top:auto;}
    #rewardsInput{width:100%;height:110px;padding:8px;margin-top:10px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box;}
    #rewardsSection p{margin:6px 0;}

    /* --- Mobile Tweaks ------------------------------------------------- */
    @media(max-width:400px){
      h1{font-size:1.3em;}
      #roulette{width:110px;height:110px;border-width:6px;font-size:1.6em;}
      .action-buttons button{flex:1 1 100%;margin:3px 0;}
      #result{font-size:1.1em;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="gameArea">
      <!-- Lucky banner will be inserted dynamically -->
      <h1>🎰 カスタムリワードガチャ 🎰</h1>
      <div id="roulette">🎯</div>
      <div class="action-buttons">
        <button onclick="drawSingle()">ガチャを回す！</button>
        <button onclick="drawFive()">5連ガチャ！</button>
        <button onclick="drawTen()">10連ガチャ！</button>
      </div>
      <div id="result"></div>

      <div id="rewardHistory">
        <span class="history-title">🎁 獲得したリワード一覧</span>
        <button id="clearHistoryBtn" onclick="clearHistory()">全削除</button>
        <div id="historyList" class="history-list"></div>
      </div>
    </div>

    <section id="rewardsSection">
      <p>リワードを <code>リワード名,確率(%)</code> の形式で改行して入力してください。</p>
      <textarea id="rewardsInput" oninput="saveRewardsInput()"></textarea>
    </section>
  </div>

<script>
/****************************
 *      CONFIG & STATE      *
 ***************************/
const LUCKY_DURATION_MIN = 60;            // ボーナスタイム継続分
const LUCKY_LEVELS = [1.5,3,5,7.5,10];    // 隠し倍率
const BONUS_PROB = 0.3;                   // 突入確率
const MISS_THRESHOLD = 15;                // ハズレ連続回数

let rewardHistory = JSON.parse(localStorage.getItem('rewardHistory')||'[]');
let consecutiveMisses = Number(localStorage.getItem('consecutiveMisses')||'0');

/****************************
 *     STORAGE HELPERS      *
 ***************************/
function saveHistory(){localStorage.setItem('rewardHistory',JSON.stringify(rewardHistory));}
function saveConsecutive(){localStorage.setItem('consecutiveMisses',consecutiveMisses);}  
function saveRewardsInput(){localStorage.setItem('rewardsInput',document.getElementById('rewardsInput').value);}  
function loadRewardsInput(){const v=localStorage.getItem('rewardsInput');document.getElementById('rewardsInput').value=v!==null?v:'ネットサーフィン10分,10';}

/****************************
 *        UI RENDER         *
 ***************************/
function renderHistory(){
  const list=document.getElementById('historyList');
  list.innerHTML='';
  rewardHistory.forEach((item,i)=>{
    const span=document.createElement('span');
    span.className='history-item';
    let label='';
    if(item.rank==='大当たり')label='★大当たり! ';
    else if(item.rank==='当たり')label='当たり! ';
    span.innerHTML=`${label}${item.name} <button class="history-remove" onclick="removeHistory(${i})">✕</button>`;
    list.appendChild(span);
  });
}
function removeHistory(i){rewardHistory.splice(i,1);renderHistory();
loadRewardsInput();
showLuckyBanner();
</script>
</body>
</html>
